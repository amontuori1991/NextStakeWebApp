@page
@model NextStakeWebApp.Areas.Admin.Pages.IndexModel
@{
    ViewData["Title"] = "SuperAdmin";
}

<h1 class="mb-3">Dashboard SuperAdmin</h1>

@if (!string.IsNullOrWhiteSpace(Model.StatusMessage))
{
    <div class="alert alert-info">@Model.StatusMessage</div>
}

<div class="card">
    <div class="card-header">
        <strong>Invia messaggio al canale Telegram</strong>
        <span class="text-muted ms-2">(Topic: <code>Idee</code>)</span>
    </div>
    <div class="card-body">
        <div asp-validation-summary="All" class="text-danger mb-3"></div>

        <form method="post">
            <div asp-validation-summary="All" class="text-danger mb-2"></div>

            @Html.AntiForgeryToken()

            <div class="mb-3">
                <label class="form-label">Testo da inviare</label>
                <textarea class="form-control" rows="6" asp-for="Input.Message" placeholder="Scrivi qui il messaggio…"></textarea>
                <span asp-validation-for="Input.Message" class="text-danger"></span>

            </div>

            <div class="row g-3 align-items-end">
                <div class="col-md-4">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" asp-for="Input.UseAI" id="useAiChk">
                        <label class="form-check-label" for="useAiChk">
                            Migliora/riscrivi con A.I. (OpenAI)
                        </label>
                    </div>
                </div>

                <div class="col-md-4">
                    <label class="form-label">Stile</label>
                    <select class="form-select" asp-for="Input.Tone" asp-items="Model.ToneOptions"></select>
                </div>

                <div class="col-md-4">
                    <label class="form-label">Lunghezza</label>
                    <select class="form-select" asp-for="Input.Length" asp-items="Model.LengthOptions"></select>
                </div>

                <input type="hidden" name="Input.Tone" id="ToneHidden" value="@Model.Input.Tone" />
                <input type="hidden" name="Input.Length" id="LengthHidden" value="@Model.Input.Length" />

            </div>

            <hr />

            <div class="d-flex gap-2">
                <button type="submit" class="btn btn-outline-primary" formaction="?handler=Preview">🧪 Genera anteprima</button>
                <button type="submit" class="btn btn-success" formaction="?handler=Send">🚀 Invia su Telegram</button>
            </div>
        </form>

        @if (!string.IsNullOrWhiteSpace(Model.Preview))
        {
            <hr />
            <div class="alert alert-secondary">
                <div class="d-flex align-items-center gap-2 mb-2">
                    <span class="badge bg-info text-dark">Anteprima</span>
                    <small class="text-muted">Questo è il testo che verrà inviato</small>
                </div>
                <div style="white-space:pre-wrap">@Model.Preview</div>
            </div>
        }
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        (function(){
          const chk = document.getElementById('useAiChk');
          const toneSel = document.getElementById('Input_Tone');
          const lenSel  = document.getElementById('Input_Length');
          const toneHid = document.getElementById('ToneHidden');
          const lenHid  = document.getElementById('LengthHidden');

          function syncDisabled(){
            const on = !!(chk && chk.checked);
            if (toneSel) toneSel.disabled = !on;
            if (lenSel)  lenSel.disabled  = !on;
          }
          function syncHidden(){
            if (toneSel && toneHid) toneHid.value = toneSel.value || 'Neutro';
            if (lenSel  && lenHid)  lenHid.value  = lenSel.value  || 'Media';
          }

          chk?.addEventListener('change', () => { syncDisabled(); syncHidden(); });
          toneSel?.addEventListener('change', syncHidden);
          lenSel?.addEventListener('change',  syncHidden);

          document.addEventListener('DOMContentLoaded', () => { syncDisabled(); syncHidden(); });
        })();
    </script>
}


