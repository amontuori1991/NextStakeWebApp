@page
@{
    Layout = "/Pages/Shared/_Layout.cshtml";
}
@model NextStakeWebApp.Areas.Admin.Pages.Users.IndexModel
@{
    ViewData["Title"] = "Gestione Utenti";
}

<div class="admin-users-page">
    <div class="container py-4">

        <h2 class="mb-4">Gestione Utenti</h2>
        @if (TempData["Msg"] is string msg)
        {
            <div class="alert alert-success d-flex align-items-center gap-2">
                <span>✅</span><span>@msg</span>
            </div>
        }

        <!-- SEZIONE: ATTIVI -->
        <div class="card mb-4">
            <div class="card-header d-flex align-items-center justify-content-between">
                <strong>Utenti Attivi</strong>
                <span class="badge bg-success">@Model.Users.Count(u => u.Status == "Attivo")</span>
            </div>
            <div class="card-body">
                @Html.Partial("_UsersTable", Model.Users.Where(u => u.Status == "Attivo").ToList())
            </div>
        </div>

        <!-- SEZIONE: IN SCADENZA -->
        <div class="card mb-4">
            <div class="card-header d-flex align-items-center justify-content-between">
                <strong>Utenti in scadenza (−3 giorni)</strong>
                <span class="badge bg-warning text-dark">@Model.Users.Count(u => u.Status == "In scadenza")</span>
            </div>
            <div class="card-body">
                @Html.Partial("_UsersTable", Model.Users.Where(u => u.Status == "In scadenza").ToList())
            </div>
        </div>

        <!-- SEZIONE: SCADUTI -->
        <div class="card">
            <div class="card-header d-flex align-items-center justify-content-between">
                <strong>Utenti scaduti</strong>
                <span class="badge bg-danger">@Model.Users.Count(u => u.Status == "Scaduto")</span>
            </div>
            <div class="card-body">
                @Html.Partial("_UsersTable", Model.Users.Where(u => u.Status == "Scaduto").ToList())
            </div>
        </div>

    </div>
</div>


@section Styles {
    <style>
        /* Tabella coerente con tema (usa variabili globali) */
        .admin-users-page .table {
            --bs-table-color: var(--text);
            --bs-table-bg: transparent;
            --bs-table-border-color: var(--border);
            --bs-table-striped-bg: rgba(255,255,255,.06);
            --bs-table-striped-color: var(--text);
            --bs-table-hover-bg: rgba(255,255,255,.10);
            --bs-table-hover-color: var(--text);
        }

        :root[data-theme="light"] .admin-users-page .table {
            --bs-table-striped-bg: rgba(0,0,0,.03);
            --bs-table-hover-bg: rgba(0,0,0,.04);
        }

        .admin-users-page .table thead th {
            white-space: nowrap;
        }

        .status-badge {
            font-size: .75rem;
        }

        /* Mobile: tabella -> cards leggibili (NO tagli, NO overflow) */
        @@media (max-width: 768px) {

            .admin-users-page .table thead {
                display: none;
            }

            .admin-users-page .table tbody tr {
                display: block;
                margin-bottom: 12px;
                border: 1px solid var(--border);
                border-radius: 12px;
                padding: 12px;
                background: var(--card);
                overflow: hidden;
            }
            /* Ogni cella diventa: LABEL | VALUE */
            .admin-users-page .table tbody td {
                display: grid;
                grid-template-columns: 120px 1fr;
                align-items: start;
                gap: 10px;
                padding: 8px 0;
                border: 0;
                white-space: normal;
            }

                .admin-users-page .table tbody td::before {
                    content: attr(data-label);
                    font-weight: 700;
                    color: var(--muted-text);
                    line-height: 1.2;
                }
            /* Valori: non devono uscire mai dalla card */
            .admin-users-page .cell-value {
                min-width: 0;
                white-space: nowrap; /* 🔒 una sola riga */
                overflow: hidden; /* nasconde il resto */
                text-overflow: ellipsis; /* … */
                text-align: right;
            }


            .admin-users-page .table-responsive {
                overflow: visible;
            }
            /* Azioni: stack verticale full width */
            .admin-users-page td.actions-cell .cell-value {
                white-space: normal; /* azioni libere */
                overflow: visible;
                text-overflow: unset;
            }


            .admin-users-page td.actions-cell form {
                display: block !important;
                margin: 8px 0 !important;
            }

            .admin-users-page td.actions-cell .form-select,
            .admin-users-page td.actions-cell .form-control,
            .admin-users-page td.actions-cell .btn {
                width: 100% !important;
            }

            .admin-users-page td.actions-cell .form-check {
                margin-top: 8px;
            }
        }
    </style>
}

